<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª â€“ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #ff4f9a;
      --primary-soft: #ff8a3d;
      --accent: #7c3aed;
      --bg: #050816;
      --card: rgba(15, 23, 42, 0.92);
      --card-soft: rgba(15, 23, 42, 0.85);
      --text: #f9fafb;
      --muted: #9ca3af;
      --radius-lg: 22px;
      --radius-md: 14px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.65);
      --glass-border: rgba(148, 163, 184, 0.45);
      --glow: 0 0 25px rgba(236, 72, 153, 0.65);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: "Cairo", sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(236, 72, 153, 0.25), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(96, 165, 250, 0.24), transparent 55%),
        radial-gradient(circle at 10% 100%, rgba(249, 115, 22, 0.24), transparent 55%),
        #020617;
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .app-shell {
      max-width: 980px;
      margin: 0 auto;
      padding: 12px 14px 24px;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 8px 2px 12px;
      background: linear-gradient(
        to bottom,
        rgba(2, 6, 23, 0.96),
        rgba(2, 6, 23, 0.75),
        transparent
      );
      backdrop-filter: blur(20px);
    }

    .hero-card {
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at 0% 0%, #f97316 0%, #ec4899 40%, #4f46e5 100%);
      border-radius: 26px;
      padding: 18px 16px 16px;
      color: #fff;
      box-shadow: var(--shadow-soft), 0 0 0 1px rgba(248, 250, 252, 0.08);
      display: flex;
      flex-direction: column;
      gap: 8px;
      isolation: isolate;
    }

    .hero-glow {
      position: absolute;
      inset: -40%;
      opacity: 0.25;
      background:
        radial-gradient(circle at 20% 0%, rgba(248, 250, 252, 0.85), transparent 55%),
        radial-gradient(circle at 90% 120%, rgba(254, 249, 195, 0.4), transparent 60%);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .hero-main {
      position: relative;
      z-index: 1;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      justify-content: space-between;
    }

    .hero-title-block {
      flex: 1;
    }

    .hero-title {
      font-size: 22px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 7px;
      letter-spacing: 0.03em;
    }

    .hero-title span.icon {
      font-size: 24px;
      filter: drop-shadow(0 0 8px rgba(248, 250, 252, 0.65));
    }

    .hero-sub {
      font-size: 14px;
      opacity: 0.97;
      margin-top: 4px;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .hero-badge {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.32);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(248, 250, 252, 0.16);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .hero-badge span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #bbf7d0;
      box-shadow: 0 0 10px rgba(190, 242, 100, 0.8);
    }

    .hero-side-pill {
      display: none;
    }

    @media (min-width: 768px) {
      .hero-main {
        align-items: center;
      }
      .hero-side-pill {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 6px;
        font-size: 11px;
      }
      .hero-pill {
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.38);
        border: 1px solid rgba(248, 250, 252, 0.16);
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }
      .hero-pill span.light {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 18px rgba(22, 163, 74, 0.95);
      }
    }

    /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      margin-top: 18px;
    }

    @media (min-width: 900px) {
      .main-grid {
        grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.05fr);
        align-items: flex-start;
      }
    }

    .card {
      background: linear-gradient(
        135deg,
        rgba(15, 23, 42, 0.96),
        rgba(15, 23, 42, 0.9)
      );
      border-radius: var(--radius-lg);
      padding: 16px 15px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(16px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 12px;
    }

    .card-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .card-title span.icon {
      font-size: 19px;
    }

    .card-caption {
      font-size: 12px;
      color: var(--muted);
    }

    .mini-pill {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.65);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .mini-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 14px rgba(56, 189, 248, 0.9);
    }

    .mini-pill:hover {
      color: #e5e7eb;
      border-color: rgba(248, 250, 252, 0.7);
    }

    /* Ø§Ù„ÙÙˆØ±Ù… */
    .form-group {
      margin-top: 10px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .required::after {
      content: " *";
      color: #f97373;
    }

    input[type="text"],
    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: radial-gradient(circle at 0% 0%, rgba(79, 70, 229, 0.22), rgba(15, 23, 42, 0.98));
      padding: 11px 12px;
      font-family: inherit;
      font-size: 16px;
      color: var(--text);
      transition: 0.2s ease;
    }

    textarea {
      resize: vertical;
      min-height: 90px;
      max-height: 240px;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148, 163, 184, 0.9);
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: rgba(248, 250, 252, 0.9);
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.6), var(--glow);
      background: radial-gradient(circle at 0% 0%, rgba(248, 250, 252, 0.12), rgba(15, 23, 42, 0.98));
    }

    .hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 3px;
    }

    .file-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: nowrap;
    }

    .file-label {
      flex: 1;
      border-radius: var(--radius-md);
      padding: 9px 10px;
      border: 1px dashed rgba(148, 163, 184, 0.9);
      font-size: 13px;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 7px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      cursor: pointer;
    }

    .file-label span.icon {
      font-size: 16px;
      color: var(--primary-soft);
    }

    #image {
      font-size: 12px;
      max-width: 130px;
    }

    .btn-main {
      width: 100%;
      margin-top: 14px;
      border-radius: 999px;
      border: none;
      padding: 11px 12px;
      font-size: 17px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      background-image: linear-gradient(135deg, #f97316, #ec4899, #6366f1);
      color: #f9fafb;
      box-shadow:
        0 12px 30px rgba(236, 72, 153, 0.55),
        0 0 0 1px rgba(248, 250, 252, 0.1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s;
    }

    .btn-main:active {
      transform: translateY(1px) scale(0.985);
      box-shadow:
        0 8px 22px rgba(236, 72, 153, 0.5),
        0 0 0 1px rgba(248, 250, 252, 0.2);
      filter: brightness(0.96);
    }

    .btn-main[disabled] {
      opacity: 0.7;
      cursor: wait;
      filter: grayscale(0.4);
    }

    .status-text {
      font-size: 13px;
      margin-top: 8px;
      text-align: center;
      min-height: 18px;
    }

    /* Ø§Ù„Ø±Ø¯ÙˆØ¯ */
    .list-scroll {
      max-height: 460px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
    }

    .note-card {
      background: var(--card-soft);
      border-radius: 18px;
      padding: 10px 10px 12px;
      margin-bottom: 11px;
      border-right: 4px solid rgba(236, 72, 153, 0.9);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.95);
      position: relative;
      overflow: hidden;
    }

    .note-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0% 0%, rgba(236, 72, 153, 0.18), transparent 55%);
      opacity: 0.8;
      pointer-events: none;
    }

    .note-inner {
      position: relative;
      z-index: 1;
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 4px;
    }

    .note-name {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
    }

    .note-badge {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.15);
      color: #bbf7d0;
      border: 1px solid rgba(22, 163, 74, 0.5);
    }

    .note-date {
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
    }

    .note-body {
      font-size: 15px;
      margin-top: 4px;
      white-space: pre-wrap;
      color: var(--text);
      line-height: 1.7;
    }

    .note-body a {
      color: #38bdf8;
      text-decoration: underline;
      font-weight: 600;
      word-break: break-all;
    }

    .note-image {
      margin-top: 7px;
      border-radius: 12px;
      width: 100%;
      max-height: 240px;
      object-fit: contain;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.95);
    }

    .reply-box {
      background: linear-gradient(
        135deg,
        rgba(16, 185, 129, 0.12),
        rgba(21, 128, 61, 0.16)
      );
      border-radius: 12px;
      padding: 8px 9px;
      margin-top: 8px;
      font-size: 13px;
      color: #bbf7d0;
      border: 1px solid rgba(22, 163, 74, 0.6);
    }

    .reply-box a {
      color: #38bdf8;
      text-decoration: underline;
      font-weight: 600;
      word-break: break-all;
    }

    .reply-title {
      font-weight: 700;
      font-size: 13px;
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .reply-image {
      margin-top: 6px;
      border-radius: 12px;
      width: 100%;
      max-height: 240px;
      object-fit: contain;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.95);
    }

    .empty-state {
      font-size: 14px;
      color: var(--muted);
      text-align: center;
      padding: 16px 8px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      inset-inline: 0;
      bottom: 0;
      height: 60px;
      background: rgba(15, 23, 42, 0.98);
      backdrop-filter: blur(20px);
      box-shadow: 0 -14px 30px rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 40;
      border-top: 1px solid rgba(148, 163, 184, 0.55);
    }

    .bottom-nav a {
      flex: 1;
      text-align: center;
      text-decoration: none;
      font-size: 12px;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .bottom-nav span.icon {
      font-size: 19px;
    }

    .bottom-nav a.active {
      color: #e5e7eb;
      font-weight: 600;
    }

    .bottom-nav a.active span.icon {
      text-shadow: 0 0 16px rgba(236, 72, 153, 0.85);
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.96);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal img {
      max-width: 95vw;
      max-height: 90vh;
      border-radius: 18px;
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.9);
    }

    .modal-close {
      position: absolute;
      top: 14px;
      inset-inline-start: 16px;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 4px 10px;
      font-size: 13px;
      cursor: pointer;
    }

    /* Scrollbar */
    .list-scroll::-webkit-scrollbar {
      width: 5px;
    }

    .list-scroll::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.9);
      border-radius: 999px;
    }

    /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· Ù„Ù„Ù‡ÙˆØ§ØªÙ */
    body {
      font-size: 17px;
      line-height: 1.8;
    }

    input,
    textarea,
    button,
    .btn-main {
      font-size: 17px;
    }

    .note-body,
    .reply-box {
      font-size: 16px;
    }

    @media (max-width: 600px) {
      body {
        font-size: 18px;
      }
      .hero-title {
        font-size: 20px;
      }
      .card-title {
        font-size: 17px;
      }
      input,
      textarea,
      button,
      .btn-main {
        font-size: 18px;
      }
      .note-body,
      .reply-box {
        font-size: 17px;
      }
    }
  </style>
</head>
<body>
<div class="app-shell" id="top">

  <header class="app-header">
    <div class="hero-card">
      <div class="hero-glow"></div>
      <div class="hero-main">
        <div class="hero-title-block">
          <div class="hero-title">
            <span class="icon">ğŸ“®</span>
            <span>ØµÙ†Ø¯ÙˆÙ‚ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</span>
          </div>
          <p class="hero-sub">
            Ø£Ø±Ø³Ù„ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸ØªÙƒØŒ ÙˆØ³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ù…Ù† Ù‚Ø¨Ù„
            <strong>Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</strong>.
          </p>
          <div class="hero-badges">
            <span class="hero-badge">
              <span class="dot"></span>
              Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù‡ÙˆØ§ØªÙ ÙˆØ§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù„ÙˆØ­ÙŠØ©
            </span>
            <span class="hero-badge">
              ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±
            </span>
            <span class="hero-badge">
              ğŸ’¬ Ø§Ù„Ø±Ø¯ÙˆØ¯ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§
            </span>
          </div>
        </div>
        <div class="hero-side-pill">
          <div class="hero-pill">
            <span class="light"></span>
            <span>Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†</span>
          </div>
          <span style="opacity:0.9;">ğŸ•’ Ø§Ù„Ø±Ø¯ Ø®Ù„Ø§Ù„ ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø¹Ù„Ù…</span>
        </div>
      </div>
    </div>
  </header>

  <main class="main-grid">

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
    <section class="card" id="sendSection">
      <div class="card-header">
        <div class="card-title-wrap">
          <div class="card-title">
            <span class="icon">ğŸ“</span>
            <span>Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
          </div>
          <p class="card-caption">
            ÙŠÙ…ÙƒÙ†Ùƒ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±ØŒ Ø§Ù„Ù…Ù‡Ù… Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø­ØªØ±Ù…Ø©.
          </p>
        </div>
      </div>

      <div class="form-group">
        <label for="name" class="required">Ø§Ù„Ø§Ø³Ù…</label>
        <input id="name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø·Ø§Ù„Ø¨ Ù…Ø¬ØªÙ‡Ø¯">
        <p class="hint">ÙŠÙ…ÙƒÙ† ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±.</p>
      </div>

      <div class="form-group">
        <label for="note" class="required">Ù†Øµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© / Ø§Ù„Ø³Ø¤Ø§Ù„</label>
        <textarea id="note" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒØŒ Ø³Ø¤Ø§Ù„ÙƒØŒ Ø±Ø£ÙŠÙƒ ÙÙŠ Ø§Ù„Ø¯Ø±Ø³..."></textarea>
        <p class="hint">ÙŠÙØ¶Ù‘Ù„ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø­ÙˆÙ„ Ù†Ù‚Ø·Ø© Ø£Ùˆ Ù†Ù‚Ø·ØªÙŠÙ† ÙÙ‚Ø·Ø› Ù„ØªØ³Ù‡ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø¯.</p>
      </div>

      <div class="form-group">
        <label>ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <div class="file-row">
          <label class="file-label" for="image">
            <span class="icon">ğŸ“·</span>
            <span id="fileLabel">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</span>
          </label>
          <input type="file" id="image" accept="image/*">
        </div>
        <p class="hint">ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù„Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù„ÙˆØ§Ø¬Ø¨ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB).</p>
      </div>

      <button class="btn-main" id="sendBtn" onclick="sendNote()">
        <span>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</span> <span>ğŸ“¤</span>
      </button>
      <p id="formStatus" class="status-text"></p>
    </section>

    <!-- Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
    <section class="card" id="replySection">
      <div class="card-header">
        <div class="card-title-wrap">
          <div class="card-title">
            <span class="icon">ğŸ’¬</span>
            <span>Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§</span>
          </div>
          <p class="card-caption">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ù† Ù‚ÙØ¨ÙÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø°.</p>
        </div>
        <button class="mini-pill" type="button" onclick="loadReplies()">
          <span class="dot"></span>
          <span>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
        </button>
      </div>

      <div id="replies" class="list-scroll">
        <div class="empty-state">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...</div>
      </div>
    </section>

  </main>
</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <a href="#top" class="active">
    <span class="icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
  </a>
  <a href="#sendSection">
    <span class="icon">ğŸ“</span>
    <span>Ø¥Ø±Ø³Ø§Ù„</span>
  </a>
  <a href="#replySection">
    <span class="icon">ğŸ’¬</span>
    <span>Ø§Ù„Ø±Ø¯ÙˆØ¯</span>
  </a>
  <a href="admin.html">
    <span class="icon">âš™ï¸</span>
    <span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
  </a>
</nav>

<!-- Modal Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© -->
<div id="imgModal" class="modal" onclick="hideModal()">
  <button class="modal-close" type="button" onclick="hideModal();event.stopPropagation();">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
  <img id="modalImg" alt="">
</div>

<script>
  // Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨
  const scriptURL = "https://script.google.com/macros/s/AKfycbzI1WkE0fUr6HaYiNMBiDn9JfTIByXjCvjQ6jnTyasz5Asyn0mLX4dNrcLVFADVHKMr/exec";

  const nameInput = document.getElementById("name");
  const noteInput = document.getElementById("note");
  const fileInput = document.getElementById("image");
  const fileLabel = document.getElementById("fileLabel");
  const formStatus = document.getElementById("formStatus");
  const sendBtn = document.getElementById("sendBtn");
  const repliesBox = document.getElementById("replies");

  fileInput.addEventListener("change", () => {
    if (fileInput.files[0]) {
      fileLabel.textContent = fileInput.files[0].name;
    } else {
      fileLabel.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©";
    }
  });

  function setStatus(message, color = "#e5e7eb") {
    formStatus.textContent = message;
    formStatus.style.color = color;
  }

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = err => reject(err);
      reader.readAsDataURL(file);
    });
  }

  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¥Ù„Ù‰ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±
  function linkify(text) {
    if (!text) return "";
    const urlRegex = /(https?:\/\/[^\s]+)/g;
    return text.replace(urlRegex, (url) => {
      const clean = url.replace(/[.,!?;:)]$/, "");
      return `<a href="${clean}" target="_blank" rel="noopener noreferrer">${clean}</a>`;
    });
  }

  async function sendNote() {
    const name = nameInput.value.trim() || "Ù…Ø¬Ù‡ÙˆÙ„";
    const note = noteInput.value.trim();

    if (!note) {
      setStatus("âŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø£ÙˆÙ„Ø§Ù‹.", "#f97373");
      return;
    }

    let img64 = "";
    const file = fileInput.files[0];
    if (file) {
      if (file.size > 5 * 1024 * 1024) {
        setStatus("âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© Ø£ÙƒØ¨Ø± Ù…Ù† 5MB.", "#f97373");
        return;
      }
      img64 = await toBase64(file);
    }

    sendBtn.disabled = true;
    setStatus("â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©...", "#93c5fd");

    try {
      const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({
          type: "add",
          name: name,
          note: note,
          image: img64
        })
      });

      const result = await res.json();
      if (result.success) {
        setStatus("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­.", "#4ade80");
        nameInput.value = "";
        noteInput.value = "";
        fileInput.value = "";
        fileLabel.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©";
        loadReplies();
      } else {
        setStatus("âŒ Ø®Ø·Ø£: " + (result.error || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"), "#f97373");
      }
    } catch (e) {
      console.error(e);
      setStatus("âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹.", "#f97373");
    } finally {
      sendBtn.disabled = false;
    }
  }

  async function loadReplies() {
    repliesBox.innerHTML = '<div class="empty-state">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...</div>';

    try {
      const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ type: "get" })
      });
      const result = await res.json();

      if (!result.success || !Array.isArray(result.data)) {
        repliesBox.innerHTML = '<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
        return;
      }

      const replied = result.data.filter(n => n.reply && n.reply.trim() !== "");
      if (replied.length === 0) {
        repliesBox.innerHTML = '<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø¹Ø¯.</div>';
        return;
      }

      replied.sort((a, b) => (b.row || 0) - (a.row || 0));

      let html = "";
      replied.forEach(n => {
        html += renderNote(n);
      });

      repliesBox.innerHTML = html;
    } catch (e) {
      console.error(e);
      repliesBox.innerHTML = '<div class="empty-state">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</div>';
    }
  }

  function renderNote(n) {
    const name = n.name || "Ù…Ø¬Ù‡ÙˆÙ„";
    const date = formatDate(n.date);
    const note = linkify((n.note || "").replace(/\n/g, "<br>"));
    const reply = linkify((n.reply || "").replace(/\n/g, "<br>"));
    const image = n.image || "";
    const replyImage = n.replyImage || "";

    return `
      <article class="note-card">
        <div class="note-inner">
          <div class="note-header">
            <div>
              <div class="note-name">
                <span>ğŸ‘¤</span><span>${name}</span>
              </div>
              <span class="note-badge">ØªÙ… Ø§Ù„Ø±Ø¯</span>
            </div>
            <div class="note-date">${date}</div>
          </div>
          <div class="note-body">${note}</div>
          ${image ? `<img class="note-image" src="${image}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©" onclick="showModal('${image}')">` : ""}
          <div class="reply-box">
            <div class="reply-title">
              <span>âœ”</span><span>Ø±Ø¯ Ø§Ù„Ø£Ø³ØªØ§Ø°:</span>
            </div>
            <div>${reply}</div>
            ${replyImage ? `<img class="reply-image" src="${replyImage}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¯" onclick="showModal('${replyImage}')">` : ""}
          </div>
        </div>
      </article>
    `;
  }

  function formatDate(d) {
    if (!d) return "";
    try {
      const dt = new Date(d);
      if (isNaN(dt.getTime())) return "";
      return dt.toLocaleString("ar-OM", {
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false
      });
    } catch {
      return "";
    }
  }

  function showModal(src) {
    const modal = document.getElementById("imgModal");
    const img = document.getElementById("modalImg");
    img.src = src;
    modal.style.display = "flex";
  }

  function hideModal() {
    const modal = document.getElementById("imgModal");
    modal.style.display = "none";
    document.getElementById("modalImg").src = "";
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© + ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ Ø¹Ø¨Ø± Ø§Ù„Ø²Ø±
  loadReplies();
</script>
</body>
</html>
