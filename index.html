<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ â€“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#f2f4f7;
  --main:#2563eb;
  --text:#1e293b;
  --bubble:#fff;
  --shadow:rgba(0,0,0,0.06);
}
body {
  margin:0;
  background:var(--bg);
  font-family:"Cairo",sans-serif;
  color:var(--text);
}
.header {
  background:var(--main);
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:700;
  color:white;
  box-shadow:0 2px 10px rgba(0,0,0,0.18);
}
.container {
  max-width:520px;
  margin:auto;
  padding:10px;
}
.card {
  background:var(--bubble);
  padding:16px;
  border-radius:14px;
  box-shadow:0 2px 8px var(--shadow);
  margin-top:15px;
}
input, textarea {
  width:100%;
  padding:10px;
  margin-top:8px;
  border:1px solid #d0d7e1;
  border-radius:10px;
  font-size:15px;
  background:#f8fafc;
}
button {
  width:100%;
  padding:12px;
  background:var(--main);
  color:white;
  border:none;
  border-radius:10px;
  font-size:17px;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
}
.note {
  background:var(--bubble);
  padding:14px;
  border-radius:12px;
  margin-top:14px;
  box-shadow:0 2px 8px var(--shadow);
}
.reply {
  background:#eafff3;
  border-right:5px solid #10b981;
  padding:10px;
  border-radius:10px;
  margin-top:12px;
}
.footer {
  text-align:center;
  margin-top:25px;
}
.footer a { color:var(--main); font-weight:700; text-decoration:none; }
img {
  width:100%;
  border-radius:10px;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="header">ğŸ“¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª</div>

<div class="container">

  <!-- Form -->
  <div class="card">
    <h3>Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ</h3>
    <input id="userName" placeholder="Ø§Ù„Ø§Ø³Ù…">
    <textarea id="userMsg" placeholder="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©â€¦" rows="4"></textarea>
    <input type="file" id="userImg" accept="image/*">
    <button onclick="sendNote()">Ø¥Ø±Ø³Ø§Ù„</button>
    <p id="status" style="color:green;"></p>
  </div>

  <h3 style="margin-top:20px;">Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
  <div id="notes"></div>

  <div class="footer">
    ğŸ›  Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: <a href="admin.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  </div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzkHX8ssX66_ES6uig9CYuWx9_9JUvlyeZH6O_jYo5AMeuuc5MAQKa-YyYPQdSEnntk/exec";

// Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø© Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
function compressBase64(base64, maxSize = 150000) {
  if (base64.length <= maxSize) return base64;
  return base64.substring(0, maxSize);
}

async function sendNote() {
  const name = document.getElementById("userName").value.trim();
  const msg  = document.getElementById("userMsg").value.trim();
  const file = document.getElementById("userImg").files[0];

  if (!name || !msg) {
    status.innerText = "â— Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©";
    return;
  }

  status.innerText = "â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦";

  if (file) {
    const reader = new FileReader();
    reader.onloadend = () => {
      const img = compressBase64(reader.result, 160000); 
      submit(name, msg, img);
    };
    reader.readAsDataURL(file);
  } else {
    submit(name, msg, "");
  }
}

async function submit(name, msg, img) {
  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({
      type: "note",
      name: name,
      message: msg,
      image: img
    })
  });

  status.innerText = "âœ” ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
  document.getElementById("userName").value = "";
  document.getElementById("userMsg").value = "";
  document.getElementById("userImg").value = "";
  loadNotes();
}

async function loadNotes() {
  const res = await fetch(scriptURL + "?getData");
  const data = await res.json();

  const notesBox = document.getElementById("notes");
  notesBox.innerHTML = "";

  const frag = document.createDocumentFragment();

  data.forEach(r => {
    const card = document.createElement("div");
    card.className = "note";

    let html = `<b>${r.name}</b><p>${r.message}</p>`;
    if (r.image) html += `<img src="${r.image}">`;

    if (r.reply || r.replyImage) {
      html += `<div class="reply">`;
      if (r.reply) html += `<b>Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù:</b> ${r.reply}<br><br>`;
      if (r.replyImage) html += `<img src="${r.replyImage}">`;
      html += `</div>`;
    } else {
      html += `<p style="color:#777;">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯</p>`;
    }

    card.innerHTML = html;
    frag.appendChild(card);
  });

  notesBox.appendChild(frag);
}

loadNotes();
</script>

</body>
</html>
