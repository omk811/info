<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">

  <title>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø§Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª â€“ Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #4f46e5;
      --primary-soft: #6366f1;
      --accent: #ec4899;
      --bg: #f3f4f6;
      --card: rgba(255, 255, 255, 0.92);
      --text: #0f172a;
      --muted: #6b7280;
      --radius-lg: 20px;
      --radius-md: 14px;
      --shadow-soft: 0 14px 35px rgba(15, 23, 42, 0.16);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Cairo", sans-serif;
      background: radial-gradient(circle at top, #e0e7ff 0%, #f9fafb 50%, #f3f4f6 100%);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 80px;
      font-size: 18px;
      line-height: 1.8;
    }

    .app-shell {
      max-width: 900px;
      margin: 0 auto;
      padding: 12px 14px 24px;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .app-header {
      padding: 10px 4px 16px;
    }

    .hero-card {
      background: linear-gradient(135deg, #4f46e5, #ec4899);
      border-radius: var(--radius-lg);
      padding: 16px 16px;
      color: #fff;
      box-shadow: var(--shadow-soft);
    }

    .hero-title {
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hero-sub {
      font-size: 15px;
    }

    .hero-badge-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .hero-badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.18);
    }

    /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 18px 14px;
      box-shadow: var(--shadow-soft);
      margin-top: 20px;
      border: 1px solid rgba(148, 163, 184, 0.22);
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-caption {
      font-size: 14px;
      color: var(--muted);
    }

    /* Ø§Ù„Ø±Ø¯ÙˆØ¯ */
    .list-scroll {
      max-height: 480px;
      overflow-y: auto;
      margin-top: 8px;
      padding-right: 4px;
    }

    .note-card {
      background: #fff;
      border-radius: 16px;
      padding: 12px;
      margin-bottom: 12px;
      border-right: 4px solid var(--primary);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.12);
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 6px;
    }

    .note-name {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .note-date {
      font-size: 13px;
      color: var(--muted);
    }

    .note-body {
      font-size: 18px;
      margin-top: 4px;
      white-space: pre-wrap;
      line-height: 1.7;
    }

    .note-image {
      margin-top: 8px;
      border-radius: 12px;
      width: 100%;
      max-height: 240px;
      object-fit: contain;
      cursor: pointer;
    }

    .reply-box {
      background: #ecfdf5;
      border-radius: 12px;
      padding: 10px;
      margin-top: 10px;
      font-size: 17px;
      color: #064e3b;
    }

    .reply-title {
      font-weight: 700;
      margin-bottom: 4px;
    }

    .reply-image {
      width: 100%;
      margin-top: 6px;
      border-radius: 12px;
      max-height: 240px;
      cursor: pointer;
    }

    /* Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
    input,
    textarea {
      width: 100%;
      border: none;
      outline: none;
      border-radius: var(--radius-md);
      background: #eef2ff;
      padding: 12px;
      font-size: 18px;
      margin-top: 6px;
    }

    textarea {
      min-height: 120px;
    }

    .btn {
      width: 100%;
      background: linear-gradient(135deg, var(--primary-soft), var(--accent));
      color: white;
      border: none;
      padding: 12px;
      font-size: 18px;
      border-radius: var(--radius-md);
      margin-top: 15px;
      cursor: pointer;
    }

    .refresh-btn {
      background: linear-gradient(135deg, #2563eb, #6366f1);
      font-size: 18px;
      margin-bottom: 16px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      inset-inline: 0;
      bottom: 0;
      height: 60px;
      background: #ffffffee;
      backdrop-filter: blur(15px);
      display: flex;
      justify-content: space-around;
      align-items: center;
      box-shadow: 0 -4px 18px rgba(0,0,0,0.15);
    }

    .bottom-nav a {
      text-decoration: none;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }

    .bottom-nav a.active {
      color: var(--primary);
      font-weight: 700;
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal img {
      max-width: 95vw;
      max-height: 90vh;
      border-radius: 16px;
    }

    .modal-close {
      position: absolute;
      top: 14px;
      left: 16px;
      background: #000000aa;
      color: #fff;
      border-radius: 999px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<!-- Ø²Ø± ØªØ­Ø¯ÙŠØ« -->
<button class="btn refresh-btn" onclick="loadReplies()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>

<div class="app-shell" id="top">

  <!-- Ù‡ÙŠØ¯Ø± -->
  <header class="app-header">
    <div class="hero-card">
      <div class="hero-title">ğŸ“® ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</div>
      <p class="hero-sub">Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ ÙˆØ³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ.</p>

      <div class="hero-badge-row">
        <span class="hero-badge">ğŸ§ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù‡ÙˆØ§ØªÙ</span>
        <span class="hero-badge">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø£Ù‡Ø§Ù„ÙŠ</span>
      </div>
    </div>
  </header>

  <!-- Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹ -->
  <section class="card" id="replySection">
    <div class="card-title">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§</div>
    <p class="card-caption">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§.</p>

    <div id="replies" class="list-scroll">
      <div class="empty-state">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...</div>
    </div>
  </section>

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
  <section class="card" id="sendSection">
    <div class="card-title">ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
    <p class="card-caption">Ø§Ù„Ø§Ø³Ù… Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” ÙŠÙ‡Ù…Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©.</p>

    <label>Ø§Ù„Ø§Ø³Ù…</label>
    <input id="name" type="text" placeholder="Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±">

    <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label>
    <textarea id="note" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..."></textarea>

    <label>Ø±ÙØ¹ ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input type="file" id="image" accept="image/*">

    <button class="btn" onclick="sendNote()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„</button>

    <p id="formStatus"></p>
  </section>

</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <a href="#top" class="active">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="#sendSection">ğŸ“ Ø¥Ø±Ø³Ø§Ù„</a>
  <a href="#replySection">ğŸ’¬ Ø§Ù„Ø±Ø¯ÙˆØ¯</a>
  <a href="admin.html">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
</nav>

<!-- Modal -->
<div id="imgModal" class="modal" onclick="hideModal()">
  <button class="modal-close">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
  <img id="modalImg" src="">
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzI1WkE0fUr6HaYiNMBiDn9JfTIByXjCvjQ6jnTyasz5Asyn0mLX4dNrcLVFADVHKMr/exec"; // â† Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ Ù‡Ù†Ø§

  const nameInput = document.getElementById("name");
  const noteInput = document.getElementById("note");
  const imageInput = document.getElementById("image");
  const statusBox = document.getElementById("formStatus");
  const repliesBox = document.getElementById("replies");

  /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ù†Ù‚Ø± */
  function linkify(text) {
    if (!text) return "";
    return text.replace(
      /(https?:\/\/[^\s]+)/g,
      (url) => `<a href="${url}" target="_blank" style="color:#2563eb;font-weight:bold;">${url}</a>`
    );
  }

  /* Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© */
  async function sendNote() {
    const name = nameInput.value.trim() || "Ù…Ø¬Ù‡ÙˆÙ„";
    const note = noteInput.value.trim();
    if (!note) {
      statusBox.textContent = "âŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©.";
      statusBox.style.color = "red";
      return;
    }

    let img64 = "";
    if (imageInput.files[0]) {
      img64 = await toBase64(imageInput.files[0]);
    }

    statusBox.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ type: "add", name, note, image: img64 })
    });

    const data = await res.json();
    if (data.success) {
      statusBox.textContent = "âœ” ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­.";
      loadReplies();
      nameInput.value = "";
      noteInput.value = "";
      imageInput.value = "";
    } else {
      statusBox.textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.";
      statusBox.style.color = "red";
    }
  }

  function toBase64(file) {
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  /* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¯ÙˆØ¯ */
  async function loadReplies() {
    repliesBox.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ type: "get" })
    });

    const data = await res.json();
    if (!data.success) {
      repliesBox.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.";
      return;
    }

    const replied = data.data.filter(r => r.reply);
    if (replied.length === 0) {
      repliesBox.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø¯ÙˆØ¯ Ø¨Ø¹Ø¯.";
      return;
    }

    repliesBox.innerHTML = replied
      .sort((a,b) => b.row - a.row)
      .map(renderNote)
      .join("");
  }

  function renderNote(n) {
    return `
      <div class="note-card">
        <div class="note-header">
          <div class="note-name">ğŸ‘¤ ${n.name}</div>
          <div class="note-date">${n.date}</div>
        </div>

        <div class="note-body">${linkify(n.note)}</div>
        ${n.image ? `<img class="note-image" src="${n.image}" onclick="showModal('${n.image}')">` : ""}

        <div class="reply-box">
          <div class="reply-title">âœ” Ø±Ø¯ Ø§Ù„Ø£Ø³ØªØ§Ø°:</div>
          <div>${linkify(n.reply)}</div>
          ${n.replyImage ? `<img class="reply-image" src="${n.replyImage}" onclick="showModal('${n.replyImage}')">` : ""}
        </div>
      </div>
    `;
  }

  /* Modal */
  function showModal(src) {
    document.getElementById("modalImg").src = src;
    document.getElementById("imgModal").style.display = "flex";
  }
  function hideModal() {
    document.getElementById("imgModal").style.display = "none";
  }

  /* ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ */
  setInterval(loadReplies, 50000);

  loadReplies();
</script>

</body>
</html>
