<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#e9edef;
  --my:#d1f4cc;
  --other:#ffffff;
  --border:#dfe1e5;
  --blue:#0084ff;
}

body {
  margin:0;
  background:var(--bg);
  font-family:"Cairo",sans-serif;
}

/* Header */
.header {
  position:sticky;
  top:0;
  background:#0084ff;
  padding:14px;
  font-size:20px;
  color:white;
  font-weight:700;
  text-align:center;
}

/* Form Box */
.card {
  max-width:520px;
  margin:auto;
  background:white;
  padding:16px;
  box-shadow:0 2px 10px rgba(0,0,0,0.08);
  border-radius:12px;
  margin-top:16px;
}

input,textarea {
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #cbd5e1;
  font-size:15px;
  background:#f8fafc;
}

button {
  width:100%;
  padding:12px;
  background:#0084ff;
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
  font-weight:700;
  margin-top:10px;
}

/* Chat message style */
.msg {
  max-width:75%;
  padding:12px;
  border-radius:12px;
  margin:14px 0;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
  font-size:15px;
  line-height:1.6;
}

.me { 
  background:var(--my); 
  margin-left:auto;
}

.other {
  background:var(--other);
  margin-right:auto;
}

.reply {
  background:#e6f7ff;
  border-right:4px solid #0084ff;
  margin-top:10px;
  padding:10px;
  border-radius:10px;
}

img {
  width:100%;
  border-radius:10px;
  margin-top:10px;
}

.footer {
  text-align:center;
  margin-top:20px;
  font-weight:700;
}

.footer a {
  color:#0084ff;
  text-decoration:none;
}

</style>
</head>

<body>

<div class="header">ğŸ’¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª</div>

<div class="card">
  <h3>Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ</h3>

  <input id="name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…">
  <textarea id="msg" rows="3" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒâ€¦"></textarea>
  <input type="file" id="img" accept="image/*">

  <button onclick="sendNote()">Ø¥Ø±Ø³Ø§Ù„</button>
  <p id="status" style="color:green;"></p>
</div>

<div style="max-width:520px; margin:auto; margin-top:20px;">
  <h3>Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
  <div id="chat"></div>
</div>

<div class="footer">
  ğŸ›  Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ â†’ <a href="admin.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbx6VNysf7TZXvV7t6foklAA8B1eNbhXm8XAZV5_y8v_gOCoGN8oIe0BMb9dCluWDzrm/exec";

function compress(base64, limit=180000) {
  if (!base64) return "";
  return base64.length <= limit ? base64 : base64.substring(0, limit);
}

async function sendNote() {
  const name = document.getElementById("name").value.trim();
  const msg  = document.getElementById("msg").value.trim();
  const file = document.getElementById("img").files[0];

  if (!name || !msg) {
    status.textContent = "â— Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
    return;
  }

  status.textContent = "â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦";

  if (file) {
    const r = new FileReader();
    r.onloadend = () => submit(name, msg, compress(r.result));
    r.readAsDataURL(file);
  } else {
    submit(name, msg, "");
  }
}

async function submit(name, msg, image) {
  await fetch(scriptURL, {
    method:"POST",
    body:JSON.stringify({ type:"note", name, message:msg, image })
  });

  document.getElementById("name").value = "";
  document.getElementById("msg").value = "";
  document.getElementById("img").value = "";
  status.textContent = "âœ” ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";

  load();
}

async function load() {
  const res = await fetch(scriptURL + "?getData");
  const data = await res.json();

  const box = document.getElementById("chat");
  box.innerHTML = "";

  const frag = document.createDocumentFragment();

  data.forEach(n => {
    const div = document.createElement("div");
    div.className = "msg other";

    let html = `<b>${n.name}</b><br>${n.message}`;
    if (n.image) html += `<img src='${n.image.split('"')[1]}'>`;

    if (n.reply || n.replyImage) {
      html += `<div class='reply'>`;
      if (n.reply) html += `<b>Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù:</b><br>${n.reply}<br>`;
      if (n.replyImage) html += `<img src='${n.replyImage.split('"')[1]}'>`;
      html += `</div>`;
    }

    div.innerHTML = html;
    frag.appendChild(div);
  });

  box.appendChild(frag);
}

load();
</script>

</body>
</html>
