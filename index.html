<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

<style>
    body {
        font-family: "Cairo", sans-serif;
        background: #f5f7fa;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #2563eb;
    }

    .note-form {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        margin-bottom: 30px;
    }

    input, textarea {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        margin-bottom: 15px;
        font-size: 16px;
    }

    button {
        background: #2563eb;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
    }

    button:hover {
        background: #1e40af;
    }

    .notes-list {
        margin-top: 30px;
    }

    .note-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }

    .note-image {
        max-width: 100%;
        border-radius: 10px;
        margin-top: 12px;
    }

    .reply-box {
        margin-top: 15px;
        padding: 15px;
        background: #e0f7eb;
        border-right: 5px solid #10b981;
        border-radius: 10px;
    }
</style>
</head>

<body>

<div class="container">

    <h1>ğŸ“® ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h1>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© -->
    <div class="note-form">
        <h2>Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ</h2>

        <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <textarea id="message" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ù†Ø§..."></textarea>

        <label>ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="file" id="imageInput" accept="image/*">

        <button onclick="sendNote()">Ø¥Ø±Ø³Ø§Ù„</button>

        <p id="status" style="margin-top:10px; font-weight:600;"></p>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
    <h2>ğŸ“¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§</h2>
    <div class="notes-list" id="notesList">
        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
    </div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwslO8ZjlGHiuvaeKlZrB5czcEbz_so6mqJGnLC9LFF6M_fI-irHDFULd5lcYC_rj8a/exec";

/* ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Base64 */
function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

/* Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© */
async function sendNote() {
    const name = document.getElementById("name").value.trim();
    const message = document.getElementById("message").value.trim();
    const status = document.getElementById("status");
    const file = document.getElementById("imageInput").files[0];

    if (!message) {
        status.textContent = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©.";
        status.style.color = "red";
        return;
    }

    status.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
    status.style.color = "#2563eb";

    let img64 = "";
    if (file) img64 = await toBase64(file);

    const payload = {
        action: "addNote",
        Name: name,
        Message: message,
        image: img64
    };

    try {
        const res = await fetch(scriptURL, {
            method: "POST",
            body: JSON.stringify(payload)
        });

        const result = await res.json();

        if (result.success) {
            status.textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­";
            status.style.color = "#10b981";

            document.getElementById("name").value = "";
            document.getElementById("message").value = "";
            document.getElementById("imageInput").value = "";

            loadNotes();

        } else {
            status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
            status.style.color = "red";
        }
    } catch (err) {
        status.textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
        status.style.color = "red";
    }
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§ ÙÙ‚Ø· */
async function loadNotes() {
    const list = document.getElementById("notesList");
    list.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

    try {
        const res = await fetch(scriptURL + "?action=getPublicNotes");
        const data = await res.json();

        if (!data.success || !data.data) {
            list.innerHTML = "âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
            return;
        }

        let html = "";

        data.data.forEach(n => {
            html += `
            <div class="note-card">
                <strong>${n.Name || "Ù…Ø¬Ù‡ÙˆÙ„"}</strong>
                <p>${n.Message}</p>

                ${n.imageURL ? `<img src="${n.imageURL}" class="note-image">` : ""}

                <div class="reply-box">
                    <strong>ğŸ”” Ø±Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…:</strong>
                    <p>${n.reply || ""}</p>
                    ${n.replyImageURL ? `<img src="${n.replyImageURL}" class="note-image">` : ""}
                </div>
            </div>
            `;
        });

        list.innerHTML = html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø¹Ø¯.";

    } catch (err) {
        list.innerHTML = "âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    }
}

loadNotes();
</script>

</body>
</html>
