<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ â€“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#f2f4f7;
  --header:#2563eb;
  --text:#1e293b;
  --bubble:#ffffff;
  --shadow:rgba(0,0,0,0.07);
}

body { margin:0; background:var(--bg); font-family:"Cairo",sans-serif; }

.app-header {
  background:var(--header);
  padding:18px;
  text-align:center;
  color:white;
  font-size:22px;
  font-weight:700;
}

.container { max-width:520px; margin:auto; padding:16px; }

.input-card {
  background:var(--bubble);
  padding:18px;
  border-radius:14px;
  box-shadow:0 3px 10px var(--shadow);
}

input, textarea {
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #cbd5e1;
}

.send-btn {
  width:100%;
  padding:13px;
  background:#2563eb;
  color:white;
  border:none;
  border-radius:12px;
  font-size:18px;
  cursor:pointer;
}
.send-btn:disabled { background:gray; cursor:not-allowed; }

#popup {
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:#10b981;
  color:white;
  padding:12px 20px;
  border-radius:10px;
  display:none;
  font-weight:600;
  z-index:999;
}

.note {
  background:white;
  padding:18px;
  border-radius:14px;
  margin:18px 0;
  box-shadow:0 3px 10px var(--shadow);
}

.reply-box {
  background:#e7fff4;
  border-right:5px solid #10b981;
  padding:12px;
  margin-top:14px;
}

</style>
</head>

<body>

<div id="popup"></div>

<div class="app-header">ğŸ“¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª</div>

<div class="container">

  <div class="input-card">
    <h3>Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>

    <input id="name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…">
    <textarea id="message" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒâ€¦" rows="4"></textarea>
    <input type="file" id="image" accept="image/*">

    <button class="send-btn" id="sendBtn" onclick="sendNote()">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>

  <h3 style="margin-top:25px;">Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h3>
  <div id="notes"></div>

  <div style="text-align:center; margin-top:30px;">
    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ â†’ <a href="admin.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbx3_-QkcYlUt_7H6tFEa-TCYqi42cLrYFkiIOAHIFPdPtzbHordfYNqeHuAVQERrvdu/exec";

function popup(msg) {
  const p = document.getElementById("popup");
  p.innerText = msg;
  p.style.display = "block";
  setTimeout(() => p.style.display = "none", 2200);
}

function toBase64(f) {
  return new Promise(res => {
    let r = new FileReader();
    r.onloadend = () => res(r.result);
    r.readAsDataURL(f);
  });
}

async function sendNote() {
  let name = document.getElementById("name").value.trim();
  let msg  = document.getElementById("message").value.trim();
  let file = document.getElementById("image").files[0];
  let btn = document.getElementById("sendBtn");

  if (!name || !msg) return popup("â— ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©");

  btn.disabled = true;
  btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦";

  let img64 = file ? await toBase64(file) : "";

  await fetch(scriptURL, {
    method:"POST",
    body:JSON.stringify({
      type:"note",
      Name: name,
      Message: msg,
      image: img64
    })
  });

  popup("âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©");

  document.getElementById("name").value = "";
  document.getElementById("message").value = "";
  document.getElementById("image").value = "";

  btn.disabled = false;
  btn.innerText = "Ø¥Ø±Ø³Ø§Ù„";

  loadNotes();
}

async function loadNotes() {
  const res = await fetch(scriptURL + "?getData");
  const data = await res.json();

  let out = "";
  data.forEach(r => {
    out += `
    <div class="note">
      <b>${r.Name}</b>
      <p>${r.Message}</p>

      ${r.imageURL ? `<img src="${r.imageURL}" style="width:100%; border-radius:10px;">` : ""}

      ${
        r.reply || r.replyImageURL
          ? `<div class="reply-box">
               ${r.reply ? `<b>Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù:</b> ${r.reply}<br><br>` : ""}
               ${r.replyImageURL ? `<img src="${r.replyImageURL}" style="width:100%; border-radius:10px;">` : ""}
             </div>`
          : `â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯`
      }
    </div>`;
  });

  document.getElementById("notes").innerHTML = out;
}

loadNotes();
</script>

</body>
</html>
