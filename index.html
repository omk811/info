<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#e9edef;
  --my:#d1f4cc;
  --other:#ffffff;
  --border:#dfe1e5;
  --blue:#0084ff;
}

body {
  margin:0;
  background:var(--bg);
  font-family:"Cairo",sans-serif;
}

.header {
  position:sticky;
  top:0;
  background:#0084ff;
  padding:14px;
  color:white;
  text-align:center;
  font-size:20px;
  font-weight:700;
}

/* form */
.card {
  max-width:520px;
  margin:auto;
  background:white;
  padding:16px;
  border-radius:12px;
  margin-top:18px;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
}

input,textarea {
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #cbd5e1;
  background:#f8fafc;
  font-size:15px;
}

button {
  width:100%;
  padding:12px;
  background:#0084ff;
  color:white;
  border:none;
  border-radius:10px;
  margin-top:10px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}

.msg {
  max-width:75%;
  padding:12px;
  border-radius:12px;
  margin:14px 0;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  background:#ffffff;
  font-size:15px;
}

.reply-box {
  background:#e6f7ff;
  border-right:4px solid #0084ff;
  padding:10px;
  border-radius:10px;
  margin-top:12px;
}

img {
  width:100%;
  border-radius:10px;
  margin-top:10px;
  max-height:250px;
  object-fit:contain;
}

.chat-container {
  max-width:520px;
  margin:auto;
  margin-top:25px;
}

.footer {
  text-align:center;
  margin:25px 0;
  font-weight:700;
}

.footer a {
  color:#0084ff;
  text-decoration:none;
}
</style>
</head>

<body>

<div class="header">ğŸ’¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª</div>

<div class="card">
  <h3>Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ</h3>

  <input id="name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…">
  <textarea id="message" rows="3" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒâ€¦"></textarea>
  <input type="file" id="image" accept="image/*">

  <button onclick="sendNote()">Ø¥Ø±Ø³Ø§Ù„</button>
  <p id="status" style="color:green;font-weight:600;"></p>
</div>

<div class="chat-container">
  <h3>Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
  <div id="chat"></div>
</div>

<div class="footer">
  Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ â†’ <a href="admin.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxfK_7ByFDvHAEj8d-jqd6rPYWQivXNk9sE9bwjM6iDYNGLiu6h59x1G5X42X3XNeIh/exec";

/* Compress */
function compress(base64, limit=300000) {
  if (!base64) return "";
  return base64.length <= limit ? base64 : base64.substring(0, limit);
}

async function sendNote(){
  const name = document.getElementById("name").value.trim();
  const message = document.getElementById("message").value.trim();
  const file = document.getElementById("image").files[0];

  if(!name || !message){
    status.textContent = "â— Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©";
    return;
  }

  status.textContent = "â³ Ø¬Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦";

  if(file){
    const r = new FileReader();
    r.onloadend = ()=> submit(name, message, compress(r.result));
    r.readAsDataURL(file);
  } else {
    submit(name, message, "");
  }
}

async function submit(name, message, image){
  await fetch(scriptURL, {
    method:"POST",
    body:JSON.stringify({
      type:"note",
      name,
      message,
      image
    })
  });

  status.textContent = "âœ” ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";

  document.getElementById("name").value = "";
  document.getElementById("message").value = "";
  document.getElementById("image").value = "";

  loadNotes();
}

async function loadNotes(){
  const res = await fetch(scriptURL + "?getData");
  const data = await res.json();

  const box = document.getElementById("chat");
  box.innerHTML = "";

  const frag = document.createDocumentFragment();

  data.forEach(n=>{
    const div = document.createElement("div");
    div.className = "msg";

    let html = `<b>${n.name}</b><br>${n.message}`;

    if(n.image){
      html += `<img src="${n.image}">`;
    }

    if(n.reply || n.replyImage){
      html += `<div class="reply-box">`;
      if(n.reply) html += `<b>Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù:</b><br>${n.reply}`;
      if(n.replyImage) html += `<img src="${n.replyImage}">`;
      html += `</div>`;
    }

    div.innerHTML = html;
    frag.appendChild(div);
  });

  box.appendChild(frag);
}

loadNotes();
</script>

</body>
</html>
