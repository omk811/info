<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #4f46e5;
      --primary-soft: #6366f1;
      --accent: #ec4899;
      --bg: #f3f4f6;
      --card: rgba(255, 255, 255, 0.92);
      --text: #0f172a;
      --muted: #6b7280;
      --radius-lg: 20px;
      --radius-md: 14px;
      --shadow-soft: 0 14px 35px rgba(15, 23, 42, 0.16);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Cairo", sans-serif;
      background: radial-gradient(circle at top, #e0e7ff 0%, #f9fafb 50%, #f3f4f6 100%);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù†Ø§Ù Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
    }

    .app-shell {
      max-width: 900px;
      margin: 0 auto;
      padding: 12px 14px 24px;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      padding: 10px 4px 16px;
      background: linear-gradient(to bottom, rgba(243, 244, 246, 0.9), rgba(243, 244, 246, 0));
      backdrop-filter: blur(10px);
    }

    .hero-card {
      background: linear-gradient(135deg, #4f46e5, #ec4899);
      border-radius: var(--radius-lg);
      padding: 16px 16px 14px;
      color: #fff;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hero-title span.icon {
      font-size: 22px;
    }

    .hero-sub {
      font-size: 13px;
      opacity: 0.96;
    }

    .hero-badge-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .hero-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.18);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    @media (min-width: 900px) {
      .main-grid {
        grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
        align-items: flex-start;
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 16px 14px 18px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(18px);
      border: 1px solid rgba(148, 163, 184, 0.22);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      font-size: 18px;
    }

    .card-caption {
      font-size: 11px;
      color: var(--muted);
    }

    /* ÙÙˆØ±Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© */
    .form-group {
      margin-top: 10px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .required::after {
      content: " *";
      color: #dc2626;
    }

    input[type="text"],
    textarea {
      width: 100%;
      border: none;
      outline: none;
      border-radius: var(--radius-md);
      background: #eef2ff;
      padding: 11px 12px;
      font-family: inherit;
      font-size: 14px;
      color: var(--text);
      transition: box-shadow 0.2s ease, background 0.2s ease;
    }

    textarea {
      resize: vertical;
      min-height: 90px;
      max-height: 220px;
    }

    input:focus,
    textarea:focus {
      background: #e0e7ff;
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.35);
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }

    .file-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .file-label {
      flex: 1;
      border-radius: var(--radius-md);
      padding: 9px 10px;
      border: 1px dashed rgba(148, 163, 184, 0.9);
      font-size: 13px;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(249, 250, 251, 0.9);
    }

    .file-label span.icon {
      font-size: 16px;
      color: var(--primary);
    }

    #image {
      font-size: 12px;
      flex: 1;
    }

    .btn {
      width: 100%;
      margin-top: 12px;
      border-radius: var(--radius-md);
      border: none;
      padding: 11px 12px;
      font-size: 15px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary-soft), var(--accent));
      color: #fff;
      box-shadow: 0 10px 22px rgba(79, 70, 229, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 7px 16px rgba(79, 70, 229, 0.35);
      filter: brightness(0.96);
    }

    .status-text {
      font-size: 12px;
      margin-top: 6px;
      text-align: center;
      min-height: 16px;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ */
    .list-scroll {
      max-height: 460px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
    }

    .note-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 10px 11px;
      margin-bottom: 10px;
      border-right: 4px solid var(--primary);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.12);
    }

    @media (prefers-color-scheme: dark) {
      .note-card {
        background: #0f172a;
      }
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 4px;
    }

    .note-name {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .note-badge {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
    }

    .note-date {
      font-size: 10px;
      color: var(--muted);
      white-space: nowrap;
    }

    .note-body {
      font-size: 13px;
      margin-top: 4px;
      white-space: pre-wrap;
      color: var(--text);
    }

    .note-image {
      margin-top: 6px;
      border-radius: 10px;
      width: 100%;
      max-height: 220px;
      object-fit: contain;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.2);
    }

    .reply-box {
      background: #ecfdf5;
      border-radius: 10px;
      padding: 7px 8px;
      margin-top: 8px;
      font-size: 12px;
      color: #064e3b;
    }

    .reply-title {
      font-weight: 700;
      font-size: 12px;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .reply-image {
      margin-top: 5px;
      border-radius: 10px;
      width: 100%;
      max-height: 220px;
      object-fit: contain;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.2);
    }

    .empty-state {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      padding: 14px 8px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      inset-inline: 0;
      bottom: 0;
      height: 56px;
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(18px);
      box-shadow: 0 -8px 24px rgba(15, 23, 42, 0.24);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 50;
    }

    .bottom-nav a {
      flex: 1;
      text-align: center;
      text-decoration: none;
      font-size: 11px;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
    }

    .bottom-nav span.icon {
      font-size: 18px;
    }

    .bottom-nav a.active {
      color: var(--primary);
      font-weight: 600;
    }

    /* Modal Ø§Ù„ØµÙˆØ±Ø© */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.93);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal img {
      max-width: 95vw;
      max-height: 90vh;
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
    }

    .modal-close {
      position: absolute;
      top: 14px;
      inset-inline-start: 16px;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    /* Scrollbar Ø¨Ø³ÙŠØ· */
    .list-scroll::-webkit-scrollbar {
      width: 4px;
    }

    .list-scroll::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.8);
      border-radius: 999px;
    }
    /* === ØªØ­Ø³ÙŠÙ† Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ù‡ÙˆØ§ØªÙ ÙˆØ§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù„ÙˆØ­ÙŠØ© ===/* === ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© === */
body {
  font-size: 17px;
}

.card-title {
  font-size: 20px;
}

.hero-title {
  font-size: 23px;
}

.hero-sub,
.card-caption {
  font-size: 16px;
}

input, textarea, .btn, label {
  font-size: 17px;
}

.note-body,
.note-snippet {
  font-size: 17px;
}

.bottom-nav a {
  font-size: 14px;
}

/* Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
@media (max-width: 600px) {
  body { font-size: 18px; }
  .card-title { font-size: 21px; }
  input, textarea, .btn { font-size: 18px; }
  .note-body { font-size: 18px; }
}
.refresh-btn {
  background: linear-gradient(135deg, #3b82f6, #6366f1);
  margin-bottom: 15px;
  font-size: 17px;
}
}
    
  </style>
</head>
<body>
<button class="btn refresh-btn" onclick="loadNotes()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
<div class="app-shell" id="top">

  <header class="app-header">
    <div class="hero-card">
      <div class="hero-title">
        <span class="icon">ğŸ“®</span>
        <span>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</span>
      </div>
      <p class="hero-sub">
        Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ø£Ùˆ Ø³Ø¤Ø§Ù„ÙƒØŒ ÙˆØ³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ.
      </p>
      <div class="hero-badge-row">
        <span class="hero-badge">ğŸ§ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù‡ÙˆØ§ØªÙ</span>
        <span class="hero-badge">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</span>
      </div>
    </div>
  </header>

  <main class="main-grid">

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
    <section class="card" id="sendSection">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">ğŸ“</span>
            <span>Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
          </div>
          <p class="card-caption">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ø³Ù…Ù‹Ø§ Ù…Ø³ØªØ¹Ø§Ø±Ù‹Ø§ Ø¥Ù† Ø£Ø­Ø¨Ø¨ØªØŒ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠÙ‡Ù…Ù†Ø§ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø§Ø³Ù….</p>
        </div>
      </div>

      <div class="form-group">
        <label for="name" class="required">Ø§Ù„Ø§Ø³Ù…</label>
        <input id="name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø·Ø§Ù„Ø¨ Ù…Ø¬ØªÙ‡Ø¯">
        <p class="hint">ÙŠÙ…ÙƒÙ† ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±.</p>
      </div>

      <div class="form-group">
        <label for="note" class="required">Ù†Øµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© / Ø§Ù„Ø³Ø¤Ø§Ù„</label>
        <textarea id="note" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒØŒ Ø³Ø¤Ø§Ù„ÙƒØŒ Ø±Ø£ÙŠÙƒ ÙÙŠ Ø§Ù„Ø¯Ø±Ø³..."></textarea>
        <p class="hint">Ù…Ù† Ø§Ù„Ø£ÙØ¶Ù„ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø­Ø¯Ø¯Ø© ÙÙŠ Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ù†Ù‚Ø·ØªÙŠÙ† ÙÙ‚Ø·.</p>
      </div>

      <div class="form-group">
        <label>ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <div class="file-row">
          <div class="file-label">
            <span class="icon">ğŸ“·</span>
            <span id="fileLabel">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</span>
          </div>
          <input type="file" id="image" accept="image/*">
        </div>
        <p class="hint">ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù„Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB.</p>
      </div>

      <button class="btn" id="sendBtn" onclick="sendNote()">
        <span>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</span> <span>ğŸ“¤</span>
      </button>
      <p id="formStatus" class="status-text"></p>
    </section>

    <!-- Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
    <section class="card" id="replySection">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">ğŸ’¬</span>
            <span>Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§</span>
          </div>
          <p class="card-caption">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ø§Ù… Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§.</p>
        </div>
      </div>

      <div id="replies" class="list-scroll">
        <div class="empty-state">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...</div>
      </div>
    </section>

  </main>
</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <a href="#top" class="active">
    <span class="icon">ğŸ </span>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
  </a>
  <a href="#sendSection">
    <span class="icon">ğŸ“</span>
    <span>Ø¥Ø±Ø³Ø§Ù„</span>
  </a>
  <a href="#replySection">
    <span class="icon">ğŸ’¬</span>
    <span>Ø§Ù„Ø±Ø¯ÙˆØ¯</span>
  </a>
  <a href="admin.html">
    <span class="icon">âš™ï¸</span>
    <span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
  </a>
</nav>

<!-- Modal Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© -->
<div id="imgModal" class="modal" onclick="hideModal()">
  <button class="modal-close" type="button" onclick="hideModal();event.stopPropagation();">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
  <img id="modalImg" alt="">
</div>

<script>
  // Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±
  const scriptURL = "https://script.google.com/macros/s/AKfycbzI1WkE0fUr6HaYiNMBiDn9JfTIByXjCvjQ6jnTyasz5Asyn0mLX4dNrcLVFADVHKMr/exec";

  const nameInput = document.getElementById("name");
  const noteInput = document.getElementById("note");
  const fileInput = document.getElementById("image");
  const fileLabel = document.getElementById("fileLabel");
  const formStatus = document.getElementById("formStatus");
  const sendBtn = document.getElementById("sendBtn");
  const repliesBox = document.getElementById("replies");

  fileInput.addEventListener("change", () => {
    if (fileInput.files[0]) {
      fileLabel.textContent = fileInput.files[0].name;
    } else {
      fileLabel.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©";
    }
  });

  function setStatus(message, color = "#4b5563") {
    formStatus.textContent = message;
    formStatus.style.color = color;
  }

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = err => reject(err);
      reader.readAsDataURL(file);
    });
  }

  async function sendNote() {
    const name = nameInput.value.trim() || "Ù…Ø¬Ù‡ÙˆÙ„";
    const note = noteInput.value.trim();

    if (!note) {
      setStatus("âŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø£ÙˆÙ„Ø§Ù‹.", "#dc2626");
      return;
    }

    let img64 = "";
    const file = fileInput.files[0];
    if (file) {
      if (file.size > 5 * 1024 * 1024) {
        setStatus("âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© Ø£ÙƒØ¨Ø± Ù…Ù† 5MB.", "#dc2626");
        return;
      }
      img64 = await toBase64(file);
    }

    sendBtn.disabled = true;
    sendBtn.style.filter = "grayscale(0.2)";
    setStatus("â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©...", "#4f46e5");

    try {
      const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({
          type: "add",
          name: name,
          note: note,
          image: img64
        })
      });

      const result = await res.json();
      if (result.success) {
        setStatus("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­.", "#16a34a");
        nameInput.value = "";
        noteInput.value = "";
        fileInput.value = "";
        fileLabel.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©";
        loadReplies();
      } else {
        setStatus("âŒ Ø®Ø·Ø£: " + (result.error || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"), "#dc2626");
      }
    } catch (e) {
      console.error(e);
      setStatus("âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹.", "#dc2626");
    } finally {
      sendBtn.disabled = false;
      sendBtn.style.filter = "none";
    }
  }

  async function loadReplies() {
    repliesBox.innerHTML = '<div class="empty-state">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...</div>';

    try {
      const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ type: "get" })
      });
      const result = await res.json();

      if (!result.success || !Array.isArray(result.data)) {
        repliesBox.innerHTML = '<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
        return;
      }

      // ÙÙ‚Ø· Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ Ø±Ø¯
      const replied = result.data.filter(n => n.reply && n.reply.trim() !== "");
      if (replied.length === 0) {
        repliesBox.innerHTML = '<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø¹Ø¯.</div>';
        return;
      }

      replied.sort((a, b) => (b.row || 0) - (a.row || 0));

      let html = "";
      replied.forEach(n => {
        html += renderNote(n);
      });

      repliesBox.innerHTML = html;
    } catch (e) {
      console.error(e);
      repliesBox.innerHTML = '<div class="empty-state">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</div>';
    }
  }

  function renderNote(n) {
    const name = n.name || "Ù…Ø¬Ù‡ÙˆÙ„";
    const date = formatDate(n.date);
    const note = (n.note || "").replace(/\n/g, "<br>");
    const reply = (n.reply || "").replace(/\n/g, "<br>");
    const image = n.image || "";
    const replyImage = n.replyImage || "";

    return `
      <article class="note-card">
        <div class="note-header">
          <div>
            <div class="note-name">
              <span>ğŸ‘¤</span><span>${name}</span>
            </div>
            <span class="note-badge">ØªÙ… Ø§Ù„Ø±Ø¯</span>
          </div>
          <div class="note-date">${date}</div>
        </div>
        <div class="note-body">${note}</div>
        ${image ? `<img class="note-image" src="${image}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©" onclick="showModal('${image}')">` : ""}
        <div class="reply-box">
          <div class="reply-title">
            <span>âœ”</span><span>Ø±Ø¯ Ø§Ù„Ø£Ø³ØªØ§Ø°:</span>
          </div>
          <div>${reply}</div>
          ${replyImage ? `<img class="reply-image" src="${replyImage}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¯" onclick="showModal('${replyImage}')">` : ""}
        </div>
      </article>
    `;
  }

  function formatDate(d) {
    if (!d) return "";
    try {
      const dt = new Date(d);
      if (isNaN(dt.getTime())) return "";
      return dt.toLocaleString("ar-OM", {
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false
      });
    } catch {
      return "";
    }
  }

  function showModal(src) {
    const modal = document.getElementById("imgModal");
    const img = document.getElementById("modalImg");
    img.src = src;
    modal.style.display = "flex";
  }

  function hideModal() {
    const modal = document.getElementById("imgModal");
    modal.style.display = "none";
    document.getElementById("modalImg").src = "";
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  loadReplies();
</script>
<!-- ================== ØªØ±Ù‚ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥ØµØ¯Ø§Ø± 6.0 ================== -->
<script>
/* ================== 1) ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ================== */
document.addEventListener("DOMContentLoaded", () => {
  const style = document.createElement("style");
  style.innerHTML = `
    body { font-size: 18px !important; line-height: 1.8 !important; }
    input, textarea, button, .btn { font-size: 18px !important; }
    .note-body, .note-snippet, .reply-box { font-size: 18px !important; }
    @media(max-width:600px){
        body { font-size: 19px !important; }
    }
  `;
  document.head.appendChild(style);
});

/* ================== 2) ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± ================== */
function linkify(text) {
  if (!text) return "";
  const urlRegex = /(https?:\/\/[^\s]+)/g;

  return text.replace(urlRegex, (url) => {
    const clean = url.replace(/[.,!?;:)]$/, "");
    return `<a href="${clean}" target="_blank" style="color:#2563eb; font-weight:bold; text-decoration:underline;">${clean}</a>`;
  });
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
function applyLinkify() {
  document.querySelectorAll(".note-body, .note-snippet, .reply-text, .selected-note-box")
    .forEach(el => { el.innerHTML = linkify(el.innerHTML); });
}

/* Ù…Ø±Ø§Ù‚Ø¨Ø© DOM Ù„Ø£ÙŠ ØªØºÙŠÙ‘Ø± â€” Ù„Ø¶Ù…Ø§Ù† ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
const observer = new MutationObserver(applyLinkify);
observer.observe(document.body, { childList: true, subtree: true });

/* ================== 3) Ø²Ø± ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ================== */
function addRefreshButton() {
  if (document.getElementById("autoRefreshBtn")) return;

  const btn = document.createElement("button");
  btn.id = "autoRefreshBtn";
  btn.textContent = "ğŸ”„ ØªØ­Ø¯ÙŠØ«";
  btn.style.cssText = `
    width:100%; padding:14px; margin:15px 0;
    background:linear-gradient(135deg,#2563eb,#6366f1);
    color:white; border:none; border-radius:12px;
    font-size:18px; cursor:pointer;
  `;
  btn.onclick = () => { if (window.loadNotes) loadNotes(); };

  const container = document.querySelector(".container, .dashboard, body");
  container.insertBefore(btn, container.firstChild);
}

document.addEventListener("DOMContentLoaded", addRefreshButton);

/* ================== 4) Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 50 Ø«Ø§Ù†ÙŠØ© ================== */
setInterval(() => {
  if (typeof loadNotes === "function") {
    loadNotes();
  }
}, 50000);

/* ================== 5) Ø¥Ø´Ø¹Ø§Ø± ØµÙˆØªÙŠ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø© (ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·) ================== */
let lastCount = 0;

// Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø§Ù„ØµÙˆØª Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
document.addEventListener("DOMContentLoaded", () => {
  if (!document.getElementById("dingSound")) {
    const audio = document.createElement("audio");
    audio.id = "dingSound";
    audio.src = "https://assets.mixkit.co/sfx/preview/mixkit-software-interface-back-2575.mp3";
    document.body.appendChild(audio);
  }
});

// Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªÙØ³ØªØ¯Ø¹Ù‰ Ø¯Ø§Ø®Ù„ loadNotes ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function notifyNewNotes(currentCount) {
  if (currentCount > lastCount && lastCount !== 0) {
    document.getElementById("dingSound").play();
  }
  lastCount = currentCount;
}
</script>
<!-- ================== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª ================== -->

</body>
</html>
