<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</title>
<style>
    body { font-family:Cairo; background:#f5f7fa; padding:30px; }
    .box { background:white; padding:25px; border-radius:15px;
           max-width:600px; margin:auto; box-shadow:0 4px 20px rgba(0,0,0,0.1); }
    input, textarea { width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin:10px 0; }
    button { background:#2563eb; color:white; padding:12px; width:100%;
             border:none; border-radius:10px; cursor:pointer; font-size:18px; }
    .note { background:#fff; border-radius:10px; padding:15px; margin:10px 0;
            border-right:5px solid #2563eb; }
</style>
</head>

<body>
<div class="box">
    <h2 style="text-align:center;color:#2563eb;">ğŸ“® ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>

    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
    <textarea id="note" rows="4" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..."></textarea>

    <label>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input type="file" id="image">

    <button onclick="sendNote()">Ø¥Ø±Ø³Ø§Ù„</button>

    <p id="status"></p>
</div>

<h3 style="text-align:center;margin-top:40px;">ğŸ’¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§</h3>
<div id="replies"></div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzI1WkE0fUr6HaYiNMBiDn9JfTIByXjCvjQ6jnTyasz5Asyn0mLX4dNrcLVFADVHKMr/exec";

/******** Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ********/
async function sendNote() {
    const name = document.getElementById("name").value.trim();
    const note = document.getElementById("note").value.trim();
    const file = document.getElementById("image").files[0];

    let base64 = "";
    if (file) base64 = await toBase64(file);

    const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ type:"add", name, note, image:base64 })
    });

    document.getElementById("status").innerHTML = "âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
    loadReplies();
}

/******** ØªØ­ÙˆÙŠÙ„ ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Base64 ********/
function toBase64(file) {
    return new Promise((resolve)=>{
        const reader = new FileReader();
        reader.onload = ()=> resolve(reader.result);
        reader.readAsDataURL(file);
    });
}

/******** ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¯ÙˆØ¯ ********/
async function loadReplies() {
    const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ type:"get" })
    });
    const data = await res.json();

    const container = document.getElementById("replies");
    container.innerHTML = "";

    data.data.filter(n=>n.reply).forEach(n=>{
        container.innerHTML += `
            <div class="note">
                <b>ğŸ‘¤ ${n.name}</b><br>
                ğŸ“ ${n.note}<br><br>
                <b style="color:green">âœ” Ø§Ù„Ø±Ø¯:</b> ${n.reply}
            </div>
        `;
    });
}

loadReplies();
</script>

</body>
</html>
