<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â€“ Ø§Ù„Ù†Ø³Ø®Ø© 4.0</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>

/* ========== ROOT ========== */
:root {
    --primary:#4f46e5;
    --secondary:#7c3aed;
    --bg:#f1f5f9;
    --card:white;
    --text:#1e293b;
}

/* DARK MODE */
.dark {
    --bg:#0f172a;
    --card:#1e293b;
    --text:#f1f5f9;
    --primary:#818cf8;
    --secondary:#a78bfa;
}

body {
    font-family:"Cairo",sans-serif;
    background:var(--bg);
    color:var(--text);
    margin:0;
    padding:15px;
}

/* CONTAINERS */
.dashboard {
    max-width:1000px;
    margin:auto;
    background:var(--card);
    padding:20px;
    border-radius:20px;
    box-shadow:0 10px 35px rgba(0,0,0,0.15);
}

h2 { text-align:center; }

/* BUTTONS */
.btn {
    padding:12px;
    background:linear-gradient(135deg,var(--primary),var(--secondary));
    color:white;
    border:none;
    border-radius:12px;
    cursor:pointer;
    width:100%;
    margin-top:10px;
    font-size:16px;
}

.back-btn {
    display:inline-block;
    padding:10px 18px;
    background:linear-gradient(135deg,var(--primary),var(--secondary));
    color:white;
    border-radius:12px;
    text-decoration:none;
    font-weight:600;
    margin-bottom:20px;
}

/* LOGIN */
.login-box {
    max-width:400px;
    margin:auto;
    background:var(--card);
    padding:20px;
    border-radius:16px;
    box-shadow:0 8px 25px rgba(0,0,0,0.15);
}

/* INPUT */
input,textarea {
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:12px;
    border:none;
    background:#e2e8f0;
    font-size:15px;
}

/* NOTES LIST */
.notes-area {
    display:flex;
    gap:20px;
    margin-top:20px;
}

.notes-list {
    width:50%;
    max-height:70vh;
    overflow-y:auto;
}

/* NOTE CARD */
.note {
    background:var(--card);
    padding:15px;
    border-radius:14px;
    margin:10px 0;
    border-right:6px solid var(--primary);
    box-shadow:0 6px 14px rgba(0,0,0,0.08);
    cursor:pointer;
    transition:0.3s;
}

.note:hover { transform:translateX(-5px); }

.note img {
    width:100%;
    border-radius:12px;
    margin-top:10px;
}

/* SELECTED NOTE */
.reply-box {
    width:50%;
    padding:15px;
    background:var(--card);
    border-radius:14px;
    max-height:70vh;
    overflow-y:auto;
    box-shadow:0 6px 14px rgba(0,0,0,0.08);
}

.status-tag {
    background:#facc15;
    color:#854d0e;
    padding:4px 10px;
    border-radius:8px;
    font-size:12px;
    display:inline-block;
    margin-bottom:5px;
}

/* DARK MODE BUTTON */
.dark-toggle {
    position:fixed;
    top:15px;
    left:15px;
    padding:8px 12px;
    background:#475569;
    color:white;
    border-radius:12px;
    cursor:pointer;
    z-index:5000;
}

/* MOBILE RESPONSIVE */
@media (max-width:800px){
    .notes-area { flex-direction:column; }
    .notes-list, .reply-box { width:100%; }
}

</style>
</head>

<body>

<!-- DARK MODE SWITCH -->
<div class="dark-toggle" onclick="toggleDark()">ğŸŒ™</div>

<!-- LOGIN -->
<div id="loginBox" class="login-box">
    <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <p id="loginStatus" style="color:red;text-align:center;"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="dashboard" style="display:none;">

    <a href="index.html" class="back-btn">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

    <h2>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

    <div class="notes-area">
        
        <!-- NOTE LIST -->
        <div class="notes-list" id="notesList"></div>

        <!-- REPLY BOX -->
        <div class="reply-box">
            <h3>ğŸ“ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
            <div id="selectedBox" style="white-space:pre-wrap;"></div>

            <textarea id="replyText" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ù‡Ù†Ø§..."></textarea>
            <input type="file" id="replyImage">

            <button class="btn" onclick="sendReply()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
        </div>

    </div>

</div>

<!-- IMAGE MODAL -->
<div id="imgModal" onclick="this.style.display='none'" 
     style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);
     display:none;align-items:center;justify-content:center;z-index:6000;">
    <img id="modalImg" style="max-width:95%;max-height:95%;border-radius:14px;">
</div>

<script>
const PASSWORD="aysha123";
const scriptURL="https://script.google.com/macros/s/AKfycbzI1WkE0fUr6HaYiNMBiDn9JfTIByXjCvjQ6jnTyasz5Asyn0mLX4dNrcLVFADVHKMr/exec";

let selectedNote=null;

/* DARK MODE */
function toggleDark(){
    document.body.classList.toggle("dark");
}

/* LOGIN */
function login(){
    let p=document.getElementById("pass").value;
    if(p===PASSWORD){
        loginBox.style.display="none";
        dashboard.style.display="block";
        loadNotes();
    } else {
        loginStatus.innerText="âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    }
}

/* LOAD NOTES */
async function loadNotes(){
    let r=await fetch(scriptURL,{method:"POST",body:JSON.stringify({type:"get"})});
    let data=await r.json();

    let box=document.getElementById("notesList");
    box.innerHTML="";

    data.data.forEach(n=>{
        box.innerHTML+=`
            <div class="note" onclick='selectNote(${n.row})'>
                <strong>${n.name}</strong><br>
                ${n.note.slice(0,80)}...
                ${n.image?`<img src="${n.image}" onclick="showImg('${n.image}');event.stopPropagation()">`:''}
                <div class="status-tag">${n.reply?"ØªÙ… Ø§Ù„Ø±Ø¯":"Ø¬Ø¯ÙŠØ¯"}</div>
            </div>
        `;
    });
}

/* SELECT NOTE */
async function selectNote(row){
    let r=await fetch(scriptURL,{method:"POST",body:JSON.stringify({type:"get"})});
    let data=await r.json();

    selectedNote=data.data.find(n=>n.row===row);

    selectedBox.innerHTML=`
        <strong>ğŸ‘¤ ${selectedNote.name}</strong><br>
        ${selectedNote.note}

        ${selectedNote.image?`
            <img src="${selectedNote.image}" 
                 onclick="showImg('${selectedNote.image}')">
        `:''}

        <hr>

        ${selectedNote.reply?`<b>âœ” Ø§Ù„Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚:</b><br>${selectedNote.reply}`:''}

        ${selectedNote.replyImage?`
            <img src="${selectedNote.replyImage}" 
                 onclick="showImg('${selectedNote.replyImage}')">
        `:''}
    `;
}

/* SHOW IMAGE MODAL */
function showImg(src){
    modalImg.src=src;
    imgModal.style.display="flex";
}

/* REPLY */
async function sendReply(){
    if(!selectedNote){ alert("Ø§Ø®ØªØ± Ù…Ù„Ø§Ø­Ø¸Ø© Ø£ÙˆÙ„Ø§Ù‹"); return; }

    let reply=replyText.value.trim();
    let file=document.getElementById("replyImage").files[0];
    let img64="";

    if(file){
        img64=await toBase64(file);
    }

    await fetch(scriptURL,{
        method:"POST",
        body:JSON.stringify({
            type:"reply",
            row:selectedNote.row,
            reply,
            replyImage:img64
        })
    });

    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯");
    loadNotes();
}

/* BASE64 */
function toBase64(file){
    return new Promise(res=>{
        let r=new FileReader();
        r.onload=()=>res(r.result);
        r.readAsDataURL(file);
    });
}
</script>

</body>
</html>
