<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â€“ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</title>
<style>
body{font-family:Cairo;background:#0a0a14;color:#fff;padding:20px}
input,textarea,button{width:100%;padding:12px;margin:8px 0}
button{background:#8b5cf6;color:#fff;border:0;border-radius:8px}
.card{background:#1e1b4b;padding:15px;border-radius:12px;margin-bottom:15px}
.hidden{display:none}
.note{border:1px solid #444;padding:10px;border-radius:8px;margin-top:10px}
</style>
</head>
<body>

<h2>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>

<div id="login">
  <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <p id="msg"></p>
</div>

<div id="panel" class="hidden">
  <button onclick="load()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
  <div id="list"></div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwnJtDbzmGs4RlwO2FMJAQ30h1Xtfig5E3yQxMzbUQncfNXuMXa-xacVxXthWKYZZu9/exec";
let ADMIN_PASS = "";

function login(){
  ADMIN_PASS = document.getElementById("pass").value;
  fetch(scriptURL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({type:"login",password:ADMIN_PASS})
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.success){
      login.style.display="none";
      panel.classList.remove("hidden");
      load();
    }else{
      msg.textContent="âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©";
    }
  });
}

function load(){
  fetch(scriptURL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({type:"get"})
  })
  .then(r=>r.json())
  .then(d=>{
    list.innerHTML="";
    d.data.forEach(n=>{
      list.innerHTML+=`
      <div class="note">
        <b>${n.name}</b><br>${n.note}
        <textarea id="r${n.row}">${n.reply||""}</textarea>
        <button onclick="reply(${n.row})">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø±Ø¯</button>
        <button onclick="del(${n.row})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>`;
    });
  });
}

function reply(row){
  fetch(scriptURL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      type:"reply",
      row:row,
      reply:document.getElementById("r"+row).value,
      password:ADMIN_PASS
    })
  }).then(()=>load());
}

function del(row){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ")) return;
  fetch(scriptURL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      type:"delete",
      row:row,
      password:ADMIN_PASS
    })
  }).then(()=>load());
}
</script>
</body>
</html>
