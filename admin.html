<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#eef2f7;
  --text:#1e293b;
  --card:#ffffff;
  --card-border:#cbd5e1;
  --main:#2563eb;
  --main-dark:#1e40af;
  --reply:#10b981;
}

.dark-mode {
  --bg:#1e293b;
  --text:#e2e8f0;
  --card:#334155;
  --card-border:#475569;
  --main:#3b82f6;
  --main-dark:#1e3a8a;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: "Cairo", sans-serif;
  margin: 0;
  padding-bottom: 40px;
}

.navbar {
  background: linear-gradient(90deg, var(--main-dark), var(--main));
  color: #fff;
  padding: 16px;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  position: relative;
}

#modeToggle {
  position: absolute;
  left: 15px;
  top: 10px;
  background: transparent;
  color: #fff;
  font-size: 22px;
  cursor: pointer;
  border: none;
}

.card {
  max-width: 900px;
  margin: 25px auto;
  background: var(--card);
  padding: 20px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  border: 1px solid var(--card-border);
}

input, textarea {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 10px;
  border: 1px solid var(--card-border);
  background: #f8fafc;
  font-size: 16px;
}

button {
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-size: 17px;
  font-weight: 600;
  cursor: pointer;
  color: #fff;
  background: var(--main);
  transition: 0.25s;
}
button:hover { background: var(--main-dark); }

.small-btn {
  padding: 8px 14px;
  font-size: 15px;
  margin: 5px;
  background: var(--main);
  border-radius: 8px;
}
.small-btn:hover { background: var(--main-dark); }

.delete-btn {
  background:#dc2626;
}
.delete-btn:hover { background:#b91c1c; }

.popup {
  position: fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background: var(--main);
  color:#fff;
  padding:12px 20px;
  border-radius:10px;
  display:none;
  font-weight:600;
  z-index:9999;
}

.counter-box {
  display:flex;
  gap:15px;
  flex-wrap:wrap;
  margin-bottom: 15px;
}
.counter {
  background:#e0e7ff;
  padding:10px 16px;
  border-radius:10px;
  font-weight:700;
  flex:1;
  min-width:130px;
  text-align:center;
  border-right:5px solid var(--main-dark);
}

.filter-box {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:15px;
}
.filter-btn {
  flex:1;
  background:#fff;
  border:1px solid var(--card-border);
  padding:8px;
  border-radius:10px;
  cursor:pointer;
  text-align:center;
  font-weight:600;
}
.filter-btn:hover {
  background:#e2e8f0;
}
.active {
  background:var(--main);
  color:white;
}

#notesList {
  margin-top: 20px;
}

.note-box {
  background: var(--card);
  border: 1px solid var(--card-border);
  padding: 20px;
  border-radius: 12px;
  margin: 18px 0;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}
</style>
</head>

<body>

<div class="navbar">
  Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  <button id="modeToggle">ğŸŒ™</button>
</div>

<div id="popup" class="popup"></div>

<!-- Login -->
<div class="card" id="loginBox">
  <h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
  <input id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <p id="loginStatus" style="color:red"></p>
</div>

<!-- Admin Panel -->
<div class="card" id="adminPanel" style="display:none;">

  <button class="small-btn" onclick="location.href='index.html'">â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

  <div class="counter-box">
    <div class="counter" id="countTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
    <div class="counter" id="countNew">Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: 0</div>
    <div class="counter" id="countReplied">Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§: 0</div>
    <div class="counter" id="countWithImg">Ù…Ø¹ ØµÙˆØ±Ø©: 0</div>
  </div>

  <div style="margin:10px 0;">
    <button class="small-btn" onclick="selectAll()">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
    <button class="small-btn" onclick="unselectAll()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
    <button class="small-btn delete-btn" onclick="deleteSelected()">Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
    <button class="small-btn" onclick="loadNotes()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
  </div>

  <div class="filter-box">
    <div class="filter-btn active" onclick="applyFilter('all', this)">Ø§Ù„ÙƒÙ„</div>
    <div class="filter-btn" onclick="applyFilter('new', this)">Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
    <div class="filter-btn" onclick="applyFilter('replied', this)">ØªÙ… Ø§Ù„Ø±Ø¯</div>
    <div class="filter-btn" onclick="applyFilter('img', this)">Ù…Ø¹ ØµÙˆØ±Ø©</div>
  </div>

  <div id="notesList"></div>

  <h3 style="margin-top:25px;">âœï¸ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</h3>

  <textarea id="replyText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯â€¦" rows="4"></textarea>

  <label style="font-size:15px; margin-top:10px; display:block;">
    ğŸ“ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ø±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
  </label>
  <input type="file" id="replyImage" accept="image/*">

  <button onclick="sendReply()">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
  <p id="replyStatus" style="color:green;"></p>

</div>


<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxjYH9nm0VsGuD0qz7MVLUD8CqLpVlI2dPqCOX5qd1qVITw2APMYruvoOF3WVM88w/exec";
const adminPassword = "Aysha123";
let allNotes = [];
let filteredNotes = [];

const modeBtn = document.getElementById("modeToggle");
modeBtn.onclick = () => {
  document.body.classList.toggle("dark-mode");
  let dark = document.body.classList.contains("dark-mode");
  modeBtn.textContent = dark ? "â˜€ï¸" : "ğŸŒ™";
  localStorage.setItem("adminDarkMode", dark);
};
window.onload = () => {
  if(localStorage.getItem("adminDarkMode") === "true"){
    document.body.classList.add("dark-mode");
    modeBtn.textContent = "â˜€ï¸";
  }
};

function popup(msg){
  const p = document.getElementById("popup");
  p.innerText = msg;
  p.style.display = "block";
  setTimeout(() => p.style.display="none", 2500);
}

function login(){
  const pass = document.getElementById("adminPass").value.trim();
  if(pass !== adminPassword){
    document.getElementById("loginStatus").innerText = "âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    return;
  }
  document.getElementById("adminPanel").style.display="block";
  document.getElementById("loginBox").style.display="none";
  loadNotes();
}

async function loadNotes(){
  const res = await fetch(scriptURL + "?getData");
  allNotes = await res.json();
  filteredNotes = allNotes;
  updateCounters();
  renderNotes();
}

function renderNotes(){
  const box = document.getElementById("notesList");
  box.innerHTML = "";

  filteredNotes.forEach((note, index) => {
    box.innerHTML += `
      <div class="note-box" style="
        display: grid;
        grid-template-columns: 40px 1fr;
        gap: 10px;
      ">
        <div style="text-align:center; padding-top:5px;">
          <input type="checkbox" class="noteCheck" value="${index}" 
                 style="transform:scale(1.5); cursor:pointer;">
        </div>

        <div>
          <b style="font-size:19px;">${note.name}</b>

          <p style="margin-top:8px; line-height:1.85;">${note.message}</p>

          ${note.image 
            ? `<img src="${note.image}" style="width:100%; border-radius:10px; margin-top:12px;">`
            : ""}

          ${
            (note.reply || note.replyImage)
              ? `
                <hr style="margin:15px 0;">
                <p style="color:var(--reply); font-size:16px;">
                  ${note.reply ? `<b>Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù:</b> ${note.reply}<br><br>` : ""}
                  ${note.replyImage ? `<img src="${note.replyImage}" style="width:100%; border-radius:10px;">` : ""}
                </p>
              `
              : `<p style="color:#999; margin-top:10px;">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯</p>`
          }
        </div>
      </div>
    `;
  });
}

function updateCounters(){
  document.getElementById("countTotal").innerText = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + allNotes.length;
  document.getElementById("countNew").innerText = "Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: " + allNotes.filter(n => !n.reply).length;
  document.getElementById("countReplied").innerText = "Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§: " + allNotes.filter(n => n.reply).length;
  document.getElementById("countWithImg").innerText = "Ù…Ø¹ ØµÙˆØ±Ø©: " + allNotes.filter(n => n.image).length;
}

function applyFilter(type, btn){
  document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  if(type === "all") filteredNotes = allNotes;
  else if(type === "new") filteredNotes = allNotes.filter(n => !n.reply);
  else if(type === "replied") filteredNotes = allNotes.filter(n => n.reply);
  else if(type === "img") filteredNotes = allNotes.filter(n => n.image);

  renderNotes();
}

function selectAll(){
  document.querySelectorAll(".noteCheck").forEach(cb => cb.checked = true);
}
function unselectAll(){
  document.querySelectorAll(".noteCheck").forEach(cb => cb.checked = false);
}

async function deleteSelected(){
  const selected = [...document.querySelectorAll(".noteCheck:checked")]
                   .map(cb => Number(cb.value));

  if(selected.length === 0) return popup("âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ø§Ø­Ø¸Ø©");

  if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŸ")) return;

  for(let index of selected){
    await fetch(scriptURL, {
      method:"POST",
      body: JSON.stringify({
        type:"delete",
        row:index+1
      })
    });
  }

  popup("ğŸ—‘ ØªÙ… Ø§Ù„Ø­Ø°Ù");
  loadNotes();
}

async function sendReply() {
  const selected = [...document.querySelectorAll(".noteCheck:checked")].map(cb => Number(cb.value));

  if (selected.length !== 1) return popup("âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ø§Ø­Ø¸Ø© ÙˆØ§Ø­Ø¯Ø©");

  const reply = document.getElementById("replyText").value.trim();
  const imgFile = document.getElementById("replyImage").files[0];

  if (!reply && !imgFile) return popup("âš ï¸ Ø§Ù„Ø±Ø¯ ÙØ§Ø±Øº");

  document.getElementById("replyStatus").innerText = "â³ ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦";

  if (imgFile) {
    const r = new FileReader();
    r.onloadend = async () => {
      await submitReply(selected[0], reply, r.result);
    };
    r.readAsDataURL(imgFile);
  } else {
    await submitReply(selected[0], reply, "");
  }
}

async function submitReply(rowIndex, reply, imageBase64) {
  await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({
      type: "reply",
      row: rowIndex + 1,
      reply: reply,
      replyImage: imageBase64
    })
  });

  popup("âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯");
  loadNotes();
  document.getElementById("replyStatus").innerText = "";
}
</script>

</body>
</html>
