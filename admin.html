<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">

  <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #4f46e5;
      --primary-soft: #6366f1;
      --accent: #ec4899;
      --bg: #f3f4f6;
      --text: #0f172a;
      --muted: #6b7280;
      --card: #ffffffdd;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow: 0 12px 28px rgba(0,0,0,0.12);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Cairo", sans-serif;
      background: #eef2ff;
      color: var(--text);
      padding-bottom: 70px;
      font-size: 18px;
      line-height: 1.8;
    }

    .container {
      max-width: 900px;
      margin: auto;
      padding: 16px;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-top: 18px;
      box-shadow: var(--shadow);
    }

    .title {
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      width: 100%;
      padding: 12px;
      margin-top: 14px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 18px;
      cursor: pointer;
    }

    .refresh-btn {
      background: linear-gradient(135deg, #2563eb, #6366f1);
    }

    .back-btn {
      background: linear-gradient(135deg, #059669, #10b981);
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      background: #e0e7ff;
      border-radius: var(--radius-md);
      border: none;
      outline: none;
      font-size: 18px;
      margin-top: 8px;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .list-scroll {
      max-height: 480px;
      overflow-y: auto;
    }

    .note-item {
      background: #fff;
      border-radius: 14px;
      padding: 12px;
      margin-bottom: 14px;
      border-right: 4px solid var(--primary);
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    .note-name {
      font-weight: 700;
      font-size: 18px;
    }

    .note-date {
      font-size: 14px;
      color: var(--muted);
    }

    .note-body {
      margin-top: 6px;
      line-height: 1.7;
      font-size: 18px;
      white-space: pre-wrap;
    }

    .note-image, .reply-image {
      margin-top: 8px;
      width: 100%;
      max-height: 260px;
      border-radius: 12px;
      cursor: pointer;
    }

    .reply-box {
      background: #ecfdf5;
      padding: 10px;
      border-radius: 12px;
      margin-top: 12px;
    }

    /* Password screen */
    #loginScreen {
      text-align: center;
      margin-top: 80px;
    }

    #loginScreen input {
      text-align: center;
      font-size: 20px;
    }

    #loginScreen .btn {
      font-size: 20px;
    }

    /* Badge */
    .counter {
      display: inline-block;
      background: #ef4444;
      color: white;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 14px;
      margin-right: 6px;
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .modal img {
      max-width: 96vw;
      max-height: 90vh;
      border-radius: 16px;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      left: 16px;
      background: #000000aa;
      color: #fff;
      padding: 6px 12px;
      border-radius: 999px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="container">

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginScreen">
    <h1 class="title">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
    <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</p>
    <input id="adminPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
    <button class="btn" onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div id="adminPanel" style="display:none;">

    <button class="btn back-btn" onclick="location.href='index.html'">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

    <div class="card">
      <div class="title">
        âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        <span id="newCounter" class="counter" style="display:none;">0 Ø¬Ø¯ÙŠØ¯</span>
      </div>

      <button class="btn refresh-btn" onclick="loadNotes()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>

      <div id="notesList" class="list-scroll" style="margin-top:14px;">
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      </div>
    </div>

    <div class="card" id="replyCard" style="display:none;">
      <div class="title">ğŸ“ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</div>

      <div id="selectedInfo"></div>

      <textarea id="replyText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ù‡Ù†Ø§..."></textarea>

      <label>Ø±ÙØ¹ ØµÙˆØ±Ø© Ø±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input type="file" id="replyImg" accept="image/*">

      <button class="btn" onclick="sendReply()">âœ” Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>

      <p id="replyStatus"></p>
    </div>

  </div>

</div>

<!-- Modal -->
<div id="imgModal" class="modal" onclick="hideModal()">
  <button class="modal-close">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
  <img id="modalImg">
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzI1WkE0fUr6HaYiNMBiDn9JfTIByXjCvjQ6jnTyasz5Asyn0mLX4dNrcLVFADVHKMr/exec"; // â† Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ Ù‡Ù†Ø§
  let notes = [];
  let selectedRow = null;
  let lastCount = 0;

  /* === ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± === */
  function checkPass() {
    const pass = document.getElementById("adminPass").value;
    if (pass === "aysha123") {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
      loadNotes();
    } else {
      alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
  }

  /* === Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© === */
  function linkify(t) {
    return t.replace(
      /(https?:\/\/[^\s]+)/g,
      (u) => `<a href="${u}" target="_blank" style="color:#2563eb;font-weight:bold;">${u}</a>`
    );
  }

  function toBase64(file) {
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  /* === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª === */
  async function loadNotes() {
    const notesList = document.getElementById("notesList");
    notesList.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ type: "get" })
    });

    const data = await res.json();
    if (!data.success) return;

    notes = data.data;

    const newOnes = notes.filter(n => !n.reply).length;
    const counter = document.getElementById("newCounter");

    if (newOnes > lastCount && lastCount !== 0) {
      ding.play();
      counter.style.display = "inline-block";
    }

    counter.textContent = newOnes + " Ø¬Ø¯ÙŠØ¯";
    lastCount = newOnes;

    notesList.innerHTML = notes
      .sort((a,b) => b.row - a.row)
      .map(renderNote)
      .join("");
  }

  function renderNote(n) {
    return `
      <div class="note-item" onclick="selectNote(${n.row})">
        <div class="note-name">${n.name}</div>
        <div class="note-date">${n.date}</div>
        <div class="note-body">${linkify(n.note)}</div>
        ${n.image ? `<img class="note-image" src="${n.image}" onclick="showModal('${n.image}');event.stopPropagation()">` : ""}
      </div>
    `;
  }

  /* === Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ø§Ø­Ø¸Ø© === */
  function selectNote(row) {
    selectedRow = row;
    const item = notes.find(n => n.row === row);

    const box = document.getElementById("selectedInfo");
    box.innerHTML = `
      <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${item.name}</p>
      <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${item.date}</p>
      <p>${linkify(item.note)}</p>
      ${item.image ? `<img class="note-image" src="${item.image}" onclick="showModal('${item.image}')">` : ""}
    `;

    document.getElementById("replyCard").style.display = "block";
  }

  /* === Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ === */
  async function sendReply() {
    const replyText = document.getElementById("replyText").value.trim();
    const replyImg = document.getElementById("replyImg").files[0];
    let img64 = "";

    if (replyImg) img64 = await toBase64(replyImg);

    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({
        type: "reply",
        row: selectedRow,
        reply: replyText,
        replyImage: img64
      })
    });

    const data = await res.json();
    const status = document.getElementById("replyStatus");

    if (data.success) {
      status.textContent = "âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯";
      loadNotes();
    } else {
      status.textContent = "âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯";
    }
  }

  /* === Modal === */
  const ding = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-software-interface-back-2575.mp3");

  function showModal(src) {
    document.getElementById("modalImg").src = src;
    document.getElementById("imgModal").style.display = "flex";
  }

  function hideModal() {
    document.getElementById("imgModal").style.display = "none";
  }

  /* ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ */
  setInterval(loadNotes, 50000);
</script>

</body>
</html>
