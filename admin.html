<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª â€“ Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#eef2f7;
  --text:#1e293b;
  --card:#ffffff;
  --card-border:#cbd5e1;
  --main:#2563eb;
  --main-dark:#1e40af;
  --reply:#10b981;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: "Cairo", sans-serif;
  margin: 0;
}
.navbar {
  background: linear-gradient(90deg, var(--main-dark), var(--main));
  color: #fff;
  padding: 16px;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
}
.card {
  max-width: 880px;
  margin: 25px auto;
  background: var(--card);
  padding: 20px;
  border-radius: 14px;
  border: 1px solid var(--card-border);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
input, textarea {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
  background: #f8fafc;
}
button {
  padding: 11px 16px;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  color: #fff;
  background: var(--main);
}
button:hover {
  background: var(--main-dark);
}
.note-box {
  border: 1px solid var(--card-border);
  padding: 20px;
  border-radius: 12px;
  background: #fff;
  margin: 18px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.counter-box {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}
.counter {
  background: #e0e7ff;
  flex: 1;
  min-width: 140px;
  text-align: center;
  padding: 10px;
  border-radius: 10px;
  font-weight: 700;
  border-right: 4px solid var(--main-dark);
}
.filter-box {
  margin: 12px 0;
  display: flex;
  gap: 10px;
}
.filter-btn {
  flex: 1;
  padding: 8px;
  border-radius: 10px;
  background: #fff;
  border: 1px solid var(--card-border);
  cursor: pointer;
  font-weight: 600;
}
.filter-btn:hover {
  background: #e2e8f0;
}
.filter-btn.active {
  background: var(--main);
  color: #fff;
}
.popup {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--main);
  color: #fff;
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: 700;
  display: none;
  z-index: 99999;
}
</style>
</head>

<body>

<div class="navbar">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>

<div id="popup" class="popup"></div>

<div class="card" id="loginBox">
  <h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
  <input id="adminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <p id="loginStatus" style="color:red"></p>
</div>

<div class="card" id="adminPanel" style="display:none;">

  <button onclick="location.href='index.html'">â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

  <div class="counter-box">
    <div class="counter" id="countTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
    <div class="counter" id="countNew">Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: 0</div>
    <div class="counter" id="countReplied">ØªÙ… Ø§Ù„Ø±Ø¯: 0</div>
    <div class="counter" id="countWithImg">Ù…Ø¹ ØµÙˆØ±Ø©: 0</div>
  </div>

  <div class="filter-box">
    <div class="filter-btn active" onclick="applyFilter('all', this)">Ø§Ù„ÙƒÙ„</div>
    <div class="filter-btn" onclick="applyFilter('new', this)">Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
    <div class="filter-btn" onclick="applyFilter('replied', this)">ØªÙ… Ø§Ù„Ø±Ø¯</div>
    <div class="filter-btn" onclick="applyFilter('img', this)">Ù…Ø¹ ØµÙˆØ±Ø©</div>
  </div>

  <div id="notesList"></div>

  <h3 style="margin-top:25px;">âœï¸ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</h3>
  <textarea id="replyText" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯â€¦"></textarea>
  <input type="file" id="replyImage" accept="image/*">
  <button onclick="sendReply()">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
  <p id="replyStatus" style="color:green;"></p>
</div>

<script>
const scriptURL = "YOUR_SCRIPT_URL_HERE";
const adminPassword = "Aysha123";

let allNotes = [];
let filteredNotes = [];

function popup(msg) {
  const p = document.getElementById("popup");
  p.innerText = msg;
  p.style.display = "block";
  setTimeout(() => p.style.display = "none", 2200);
}

function login() {
  const pass = adminPass.value.trim();
  if (pass !== adminPassword) {
    loginStatus.innerText = "âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    return;
  }
  adminPanel.style.display = "block";
  loginBox.style.display = "none";
  loadNotes();
}

async function loadNotes() {
  const res = await fetch(scriptURL + "?getData");
  allNotes = await res.json();
  filteredNotes = allNotes;
  updateCounters();
  renderNotes();
}

function renderNotes() {
  notesList.innerHTML = "";

  filteredNotes.forEach((note, index) => {
    notesList.innerHTML += `
      <div class="note-box">
        <b style="font-size:18px;">${note.Name}</b>
        <p style="margin-top:6px;">${note.Message}</p>

        ${note.imageURL
          ? `<img src="${note.imageURL}" 
                 style="width:100%; max-height:260px; object-fit:contain; 
                        border-radius:10px; margin-top:10px;">`
          : ""}

        ${note.reply || note.replyImageURL
          ? `
            <div style="margin-top:12px; padding:10px; background:#e7fff4; border-right:4px solid #10b981; border-radius:10px;">
              ${note.reply ? `<b>Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù:</b> ${note.reply}` : ""}
              ${note.replyImageURL 
                ? `<img src="${note.replyImageURL}" style="width:100%; max-height:260px; object-fit:contain; margin-top:10px; border-radius:10px;">`
                : ""}
            </div>`
          : `<p style="color:#999; margin-top:8px;">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯</p>`}
      </div>
    `;
  });
}

function updateCounters() {
  countTotal.innerText = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + allNotes.length;
  countNew.innerText = "Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: " + allNotes.filter(n => !n.reply).length;
  countReplied.innerText = "ØªÙ… Ø§Ù„Ø±Ø¯: " + allNotes.filter(n => n.reply).length;
  countWithImg.innerText = "Ù…Ø¹ ØµÙˆØ±Ø©: " + allNotes.filter(n => n.imageURL).length;
}

function applyFilter(type, el) {
  document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
  el.classList.add("active");

  if (type === "all") filteredNotes = allNotes;
  else if (type === "new") filteredNotes = allNotes.filter(n => !n.reply);
  else if (type === "replied") filteredNotes = allNotes.filter(n => n.reply);
  else if (type === "img") filteredNotes = allNotes.filter(n => n.imageURL);

  renderNotes();
}

async function sendReply() {
  const reply = replyText.value.trim();
  const imgFile = replyImage.files[0];

  if (!reply && !imgFile) return popup("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ø£Ùˆ Ø£Ø±ÙÙ‚ ØµÙˆØ±Ø©");

  replyStatus.innerText = "â³ ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦";

  let img64 = "";
  if (imgFile) {
    img64 = await toBase64(imgFile);
  }

  const res = await fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({
      type: "reply",
      row: filteredNotes[0].row,
      reply,
      replyImage: img64
    })
  });

  replyStatus.innerText = "âœ” ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
  loadNotes();
}

function toBase64(file) {
  return new Promise((resolve) => {
    const r = new FileReader();
    r.onloadend = () => resolve(r.result);
    r.readAsDataURL(file);
  });
}
</script>

</body>
</html>
